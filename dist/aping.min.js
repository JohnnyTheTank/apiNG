/**
    @name: aping 
    @version: 0.8.1 (11-01-2016) 
    @author: Jonathan Hornung <jonathan.hornung@gmail.com> 
    @url: https://github.com/JohnnyTheTank/apiNG#readme 
    @license: MIT
*/
"use strict";var apingApp=angular.module("jtt_aping",["jtt_aping_jsonloader","jtt_aping_ng_array"]).config(["$provide",function(a){a.value("apingDefaultSettings",{apingApiKeys:{}})}]).directive("aping",["apingDefaultSettings","apingUtilityHelper",function(a,b){return{restrict:"E",replace:"false",scope:{model:"@",getNativeData:"@",items:"@",maxItems:"@",orderBy:"@",orderReverse:"@",templateUrl:"@",payloadJson:"@",removeDoubles:"@"},controller:["$scope",function(c){c.results=[],c.payload=c.payloadJson?b.replaceSingleQuotesAndParseJson(c.payloadJson):{},this.getAppSettings=function(){var b,d,e,f,g,h;return b="undefined"!=typeof c.items?c.items:"undefined"!=typeof a.items?a.items:void 0,d="undefined"!=typeof c.maxItems?c.maxItems:"undefined"!=typeof a.maxItems?a.maxItems:void 0,e="undefined"!=typeof c.getNativeData?c.getNativeData:"undefined"!=typeof a.getNativeData?a.getNativeData:!1,d="undefined"!=typeof c.maxItems?c.maxItems:"undefined"!=typeof a.maxItems?a.maxItems:void 0,g="undefined"!=typeof c.orderBy?c.orderBy:"undefined"!=typeof a.orderBy?a.orderBy:"undefined",f="undefined"!=typeof c.orderReverse?c.orderReverse:"undefined"!=typeof a.orderReverse?a.orderReverse:!1,h="undefined"!=typeof c.removeDoubles?c.removeDoubles:"undefined"!=typeof a.removeDoubles?a.removeDoubles:!1,{model:c.model||a.model||"native",getNativeData:e,items:b,maxItems:d,orderBy:g,orderReverse:f,removeDoubles:h}},this.concatToResults=function(a){c.results=c.results.concat(a);var d=this.getAppSettings();(d.removeDoubles===!0||"true"===d.removeDoubles)&&(c.results=b.removeDuplicateObjectsFromArray(c.results,d.orderBy===!1||"false"===d.orderBy||"$NONE"===d.orderBy)),"undefined"!==d.orderBy&&d.orderBy!==!1&&"false"!==d.orderBy&&"$NONE"!==d.orderBy&&("$RANDOM"===d.orderBy?c.results=b.shuffleArray(c.results):(c.results.sort(b.sortArrayByProperty(d.orderBy)),(d.orderReverse===!0||"true"===d.orderReverse)&&c.results.reverse())),d.maxItems>-1&&c.results.length>d.maxItems&&(c.results=c.results.splice(0,d.maxItems)),c.$broadcast("apiNG.resultMerged")},this.apply=function(){c.$apply()}}],templateUrl:function(b,c){return c.templateUrl||a.templateUrl}}}]);apingApp.service("apingTimeHelper",function(){this.getTimestampFromDateString=function(a,b,c){if(("undefined"==typeof b||isNaN(b))&&(b=1),("undefined"==typeof c||isNaN(c))&&(c=0),"string"==typeof a){var d=a.split(/[^0-9]/);try{return parseInt(Math.round(new Date(d[0],d[1]-1,d[2],d[3],d[4],d[5])/1e3*b)+c,10)}catch(e){return 0}}return 0}}).service("apingUtilityHelper",["apingInputObjects","apingDefaultSettings",function(a,b){this.getApiCredentials=function(a,c){return b.apingApiKeys&&b.apingApiKeys[a]?b.apingApiKeys[a][Math.floor(Math.random()*b.apingApiKeys[a].length)][c]:!1},this.parseJsonFromAttributes=function(a,b,c){return this.parseRequestsFromAttributes(a,b,c)},this.parseRequestsFromAttributes=function(b,c,d){if("string"!=typeof b||!b)return[];var e=[],f=this.replaceSingleQuotesAndParseJson(b);return angular.forEach(f,function(b,f){b.platform=c,d&&("undefined"==typeof b.items&&"undefined"!=typeof d.items&&(b.items=d.items),"undefined"==typeof b.model&&"undefined"!=typeof d.model&&(b.model=d.model));var g=a.getNew("request",b);e.push(g)}),e},this.replaceSingleQuotesAndParseJson=function(a){return $.parseJSON(a.replace(/'/g,'"'))},this.sortArrayByProperty=function(a){var b=1;return"-"===a[0]&&(b=-1,a=a.substr(1)),function(c,d){var e=c[a]<d[a]?-1:c[a]>d[a]?1:0;return e*b}},this.shuffleArray=function(a){for(var b=a.length-1;b>0;b--){var c=Math.floor(Math.random()*(b+1)),d=a[b];a[b]=a[c],a[c]=d}return a},this.removeDuplicateObjectsFromArray=function(a,b){var c=[],d="apingStringified",e="apingTempOrder";if(1===a.length)return a;$.each(a,function(a,f){f.$$hashKey=void 0,f[d]=JSON.stringify(f),b===!0&&(f[e]=a),c.push(f)}),c.sort(this.sortArrayByProperty(d));var f,g=[];return $.each(c,function(a,b){"undefined"!=typeof f?"undefined"!=typeof b[d]&&b[d]!==f&&g.push(b):g.push(b),f=b[d],b[d]=void 0}),b===!0&&(c.sort(this.sortArrayByProperty(e)),$.each(c,function(a,b){b[e]=void 0})),g},this.getTextFromHtml=function(a){return a=a.replace(/&lt;br ?\/\>|&lt;br ?\/&rt;|\<br ?\/\>/g," "),a=a.replace(/<(?:.|\n)*?>/gm,"")},this.getFirstImageFromHtml=function(a){var b=/<img[^>]+src="([^">]+)/g;return b.exec(a)},this.parseParametersFromUrl=function(a){var b={};return"string"==typeof a&&(b=JSON.parse('{"'+decodeURI(a.replace(/&/g,'","').replace(/=/g,'":"'))+'"}')),b}}]),apingApp.service("apingInputObjects",["apingDefaultSettings",function(a){this.getNew=function(b,c){var d={};switch(b){case"request":d=$.extend(!0,{model:a.model,items:a.items},c)}return d}}]),apingApp.service("apingModels",[function(){this.getNew=function(a,b){var c={};switch(a){case"social":c={platform:b,blog_name:void 0,blog_id:void 0,blog_link:void 0,type:void 0,timestamp:void 0,date_time:void 0,post_url:void 0,intern_id:void 0,text:void 0,caption:void 0,img_url:void 0,source:void 0,likes:void 0,shares:void 0,comments:void 0,position:void 0};break;case"video":c={platform:b,blog_name:void 0,blog_id:void 0,blog_link:void 0,timestamp:void 0,date_time:void 0,post_url:void 0,intern_id:void 0,text:void 0,caption:void 0,img_url:void 0,source:void 0,markup:void 0,likes:void 0,shares:void 0,duration:void 0,width:void 0,height:void 0,comments:void 0,position:void 0};break;case"image":c={platform:b,blog_name:void 0,blog_id:void 0,blog_link:void 0,timestamp:void 0,date_time:void 0,post_url:void 0,intern_id:void 0,text:void 0,caption:void 0,thumb_url:void 0,thumb_width:void 0,thumb_height:void 0,img_url:void 0,img_width:void 0,img_height:void 0,native_url:void 0,native_width:void 0,native_height:void 0,source:void 0,likes:void 0,shares:void 0,comments:void 0,position:void 0};break;case"event":c={platform:b,artist_name:void 0,artist_id:void 0,artist_link:void 0,start_timestamp:void 0,start_date_time:void 0,end_timestamp:void 0,end_date_time:void 0,event_url:void 0,ticket_url:void 0,sold_out:void 0,intern_id:void 0,text:void 0,caption:void 0,img_url:void 0,place_name:void 0,city:void 0,country:void 0,latitude:void 0,longitude:void 0,street:void 0,zip:void 0,source:void 0};break;case"repo":c={platform:b,owner_name:void 0,owner_id:void 0,owner_link:void 0,owner_img_url:void 0,name:void 0,id:void 0,fullname:void 0,description:void 0,url:void 0,homepage:void 0,language:void 0,clone_url:void 0,git_url:void 0,ssh_url:void 0,svn_url:void 0,isFork:void 0,openIssues:void 0,watchers:void 0,stargazers:void 0,forks:void 0,created_timestamp:void 0,created_date_time:void 0,updated_timestamp:void 0,updated_date_time:void 0,pushed_timestamp:void 0,pushed_date_time:void 0};break;case"activity":c={platform:b,body:void 0,actor_name:void 0,actor_id:void 0,actor_url:void 0,actor_img_url:void 0,actor_type:void 0,action_name:void 0,action_message:void 0,action_id:void 0,action_url:void 0,action_img:void 0,action_type:void 0,object_name:void 0,object_id:void 0,object_img:void 0,object_url:void 0,object_type:void 0,context:void 0,timestamp:void 0,date_time:void 0};break;case"weather":c={platform:b,weather_code:void 0,weather_caption:void 0,weather_text:void 0,weather_icon_name:void 0,weather_icon_url:void 0,temp:void 0,pressure:void 0,humidity:void 0,temp_min:void 0,temp_max:void 0,sea_level:void 0,grnd_level:void 0,wind_speed:void 0,wind_deg:void 0,rain_duration:void 0,rain_volume:void 0,clouds:void 0,timestamp:void 0,date_time:void 0,sunrise_timestamp:void 0,sunrise_date_time:void 0,sunset_timestamp:void 0,sunset_date_time:void 0,loc_city:void 0,loc_city_id:void 0,loc_country:void 0,loc_lat:void 0,loc_lng:void 0,loc_zip:void 0}}return c}}]),angular.module("jtt_aping_jsonloader",[]).directive("apingJsonloader",["apingUtilityHelper","jsonloaderFactory",function(a,b){return{require:"?aping",restrict:"A",replace:"false",link:function(c,d,e,f){var g=f.getAppSettings(),h=a.parseJsonFromAttributes(e.apingJsonloader,"jsonloader",g);h.forEach(function(a){if(a.path){var c={path:a.path};if(a.format&&"jsonp"==a.format.toLowerCase()?c.format="jsonp":c.format="json",a.callback&&"jsonp"===a.format?c.callback=a.callback:c.callback="JSON_CALLBACK","undefined"!=typeof a.items?c.count=a.items:c.count=g.items,0===c.count||"0"===c.count)return!1;(c.count<0||isNaN(c.count))&&(c.count=void 0),b.getJsonData(c).then(function(b){var c=[];b.data&&(b.data.constructor!==Array?c.push(b.data):a.items<0||"undefined"==typeof a.items?c=b.data:angular.forEach(b.data,function(b,d){d<a.items&&c.push(b)})),f.concatToResults(c)})}})}}}]).factory("jsonloaderFactory",["$http",function(a){var b={};return b.getJsonData=function(b){return"jsonp"==b.format?a.jsonp(b.path,{method:"GET",params:{callback:b.callback}}):a({method:"GET",url:b.path})},b}]),angular.module("jtt_aping_ng_array",[]).directive("apingNgArray",["apingUtilityHelper",function(a){return{require:"?aping",restrict:"A",replace:"false",link:function(b,c,d,e){var f=e.getAppSettings(),g=a.parseJsonFromAttributes(d.apingNgArray,"ngArray",f);g.forEach(function(a){if(a.name&&b[a.name]){var c={};if("undefined"!=typeof a.items?c.count=a.items:c.count=f.items,0===c.count||"0"===c.count)return!1;(c.count<0||isNaN(c.count))&&(c.count=void 0);var d=[];b[a.name].constructor===Array?c.items<0||"undefined"==typeof c.items?d=b[a.name]:angular.forEach(b[a.name],function(b,c){c<a.items&&d.push(b)}):"object"==typeof b[a.name]&&null!==b[a.name]&&d.push(b[a.name]),d.length>0&&e.concatToResults(d)}})}}}]);